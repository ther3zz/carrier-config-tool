<!-- START OF FILE templates/partials/_vonage_credential_management.html -->
<details id="credentialManagementAccordion">
    <summary>Credential Management</summary>
    <div class="action-content">
        <div style="padding: 0 20px 20px 20px;">
            <h3>Session Master Key</h3>
            <p>Enter a Master Key for this browser session. This key is used to encrypt/decrypt your API secrets. It is <strong>never</strong> stored on the server.</p>
            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                <input type="password" id="masterKeyInput" placeholder="Enter your session Master Key" style="flex-grow: 1;">
                <button type="button" id="setMasterKeyButton">Set & Load</button>
            </div>
            <div id="masterKeyStatus" style="margin-top: -10px; margin-bottom: 20px;"></div>
            
            <hr style="margin: 30px 0;">

            <h3>Manage Stored Credentials</h3>
            <div id="credentialManagerUI" style="display: none;">
                <div class="credential-sections-container">
                    <div class="credential-section">
                        <h4>Add New Credential</h4>
                        <form id="addCredentialForm">
                            <div class="form-group">
                                <label for="credentialName">Friendly Name:</label>
                                <input type="text" id="credentialName" required placeholder="e.g., Vonage Subaccount [GroupID]">
                            </div>
                            <div class="form-group">
                                <label for="credentialApiKey">API Key / Username:</label>
                                <input type="text" id="credentialApiKey" required>
                            </div>
                            <div class="form-group">
                                <label for="credentialApiSecret">API Secret / Password:</label>
                                <input type="password" id="credentialApiSecret" required>
                            </div>
                            <hr class="settings-divider">
                            <p style="font-weight: bold; margin-bottom: 10px;">Default Provisioning Settings (Optional)</p>
                            <div class="form-group">
                                <label for="credentialVoiceCallbackType">Default Voice Callback Type:</label>
                                <select id="credentialVoiceCallbackType">
                                    <option value="">-- None --</option>
                                    <option value="sip">sip</option>
                                    <option value="tel">tel</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="credentialVoiceCallbackValue">Default Voice Callback Value:</label>
                                <input type="text" id="credentialVoiceCallbackValue" placeholder="e.g., sbc.domain.com or 12125551212">
                            </div>
                            <button type="submit">Save Credential</button>
                        </form>
                    </div>
                    <div class="credential-section">
                        <h4>Saved Credentials</h4>
                        <div id="credentialListContainer">
                        </div>
                    </div>
                </div>
                <hr style="margin: 30px 0;">
                <div class="credential-sections-container">
                    <div class="credential-section">
                        <h4>Bulk Import Credentials (Tab-Separated)</h4>
                        <p>Paste data from a spreadsheet. Each line should contain three columns separated by a <strong>Tab</strong>:</p>
                        <small><code>Friendly Name &lt;Tab&gt; API Key &lt;Tab&gt; API Secret</code></small>
                        <div class="form-group">
                            <textarea id="bulkCredentialInput" rows="5" placeholder="Vonage-Primary	abcdef12	1234567890ABCDEF&#10;Vonage-Sub1	345678ab	FEDCBA0987654321"></textarea>
                        </div>
                        <button type="button" id="importCredentialsButton" class="action-button">Import from Text</button>
                    </div>
                    <div class="credential-section">
                        <h4>Import Status</h4>
                        <div id="importStatusArea" style="max-height: 200px; overflow-y: auto;">
                            <p><i>Awaiting import...</i></p>
                            <ul id="importStatusList" style="list-style-type: none; padding-left: 0;"></ul>
                        </div>
                    </div>
                </div>

                
                <hr style="margin: 30px 0;">
                <div class="credential-sections-container">
                    <div class="credential-section">
                        <h4>Import from Encrypted File</h4>
                        <p>
                            Upload an existing <code>credentials.json</code> file to migrate credentials into the database.
                            You must have the correct <strong>Session Master Key</strong> set above for decryption to succeed.
                        </p>
                        <div class="form-group">
                            <label for="credentialFileUpload">Select <code>credentials.json</code> file:</label>
                            <input type="file" id="credentialFileUpload" accept=".json">
                        </div>
                        <button type="button" id="importFromFileButton" class="action-button">Import from File</button>
                    </div>
                </div>
                
                <hr style="margin: 30px 0;">
                <div class="credential-section-full-width">
                    <h4>Re-key All Credentials</h4>
                    <p class="warning-text">
                        <strong>Warning:</strong> This is a high-risk operation. If the wrong 'Old Master Key' is provided,
                        <strong>all credentials will become unrecoverable.</strong> There is no undo.
                    </p>
                    <form id="rekeyCredentialsForm">
                        <div class="form-group">
                            <label for="oldMasterKeyInput">Old Master Key:</label>
                            <input type="password" id="oldMasterKeyInput" required placeholder="The key currently encrypting the data">
                        </div>
                        <div class="form-group">
                            <label for="newMasterKeyInput">New Master Key:</label>
                            <input type="password" id="newMasterKeyInput" required placeholder="The new key to encrypt the data with">
                        </div>
                        <button type="button" id="rekeyCredentialsButton" class="danger-button">Re-key All Credentials</button>
                    </form>
                    <div id="rekeyStatusArea" style="margin-top: 15px;">
                        <ul id="rekeyStatusList" style="list-style-type: none; padding-left: 0;"></ul>
                    </div>
                </div>

            </div>
        </div>
    </div>
</details>
<!-- END OF FILE templates/partials/_vonage_credential_management.html -->